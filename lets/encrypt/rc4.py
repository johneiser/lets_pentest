from lets.__module__ import Module
from Cryptodome.Cipher import ARC4
import os, base64


class RC4(Module):
    """
    RC4 encrypt the supplied data.
    """
    
    @classmethod
    def add_arguments(self, parser):
        parser.add_argument("-k", "--key", type=str,
            help="encryption key")

    def handle(self, input, key=None):
        assert input is not None, "Must provide data as input"

        # Retrieve data
        for data in input:

            # Generate key
            key = key.encode() if key else os.urandom(32)

            # Encrypt data with key
            self.log.info("Encrypting %i bytes with key: %s", len(data), base64.b64encode(key).decode())
            yield ARC4.new(key).encrypt(data)
